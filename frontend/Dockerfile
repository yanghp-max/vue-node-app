# é˜¶æ®µ1: æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS build

WORKDIR /app

# å¤åˆ¶ package.json å’Œ package-lock.json
COPY package*.json ./

# å®‰è£…å…¨éƒ¨ä¾èµ–
RUN npm ci

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN npm run build

# é˜¶æ®µ2: ç”Ÿäº§é˜¶æ®µ
FROM nginx:alpine

# ğŸ”´ å…³é”®æ­¥éª¤ï¼šå…ˆåˆ é™¤ Nginx é»˜è®¤çš„ä¸»é…ç½®æ–‡ä»¶ï¼ˆé¿å…è¦†ç›–å¤±è´¥ï¼‰
RUN rm -f /etc/nginx/nginx.conf /etc/nginx/conf.d/default.conf

# å¤åˆ¶æ„å»ºç»“æœåˆ° nginxï¼ˆè·¯å¾„æ­£ç¡®ï¼Œå’Œä½ çš„ Nginx é…ç½® root å¯¹åº”ï¼‰
COPY --from=build /app/dist /usr/share/nginx/html

# å¤åˆ¶ä½ çš„è‡ªå®šä¹‰ Nginx ä¸»é…ç½®ï¼ˆç°åœ¨èƒ½ç¡®ä¿è¦†ç›–æˆåŠŸï¼‰
COPY nginx.conf /etc/nginx/nginx.conf

# æš´éœ²ç«¯å£
EXPOSE 80

# å¯åŠ¨ nginx
CMD ["nginx", "-g", "daemon off;"]
